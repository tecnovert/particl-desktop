
# Run tests with Docker image

sudo sysctl -w net.ipv4.ip_forward=1
sudo systemctl restart systemd-networkd
sudo systemctl start docker

Onceoff:

    cd ~/tmp/work/particl/particl-desktop/test
    rm -rf ../node_modules/

    sed -i 's/git+ssh/git+https/g' ../package-lock.json
    sed -i 's/git+ssh/git+https/g' ../yarn.lock

    docker compose build --no-cache

    docker network create pdtest_network --subnet="172.16.238.0/24"


    Requires particl core binaries at ~/tmp/particl-23.1.5.0/bin/
        Or set PARTICL_CLIDIR to location

# Reset tests
sudo rm -r /tmp/pdtests

mkdir -p /tmp/pdtests/{node1,node2}/.config/particl-desktop-testing/settings/
mkdir -p /tmp/pdtests/{node1,node2}/.particl
cp particl-core.json /tmp/pdtests/node1/.config/particl-desktop-testing/settings/particl-core.json
cp particl-core.json /tmp/pdtests/node2/.config/particl-desktop-testing/settings/particl-core.json
cp particl.conf /tmp/pdtests/node1/.particl/
cp particl.conf /tmp/pdtests/node2/.particl/
mkdir -p /tmp/pdtests/{node1,node2}/.config/particl-desktop-testing/binaries/particl/
cp ~/tmp/particl-23.1.5.0-x86_64-linux-gnu.tar.gz /tmp/pdtests/node1/.config/particl-desktop-testing/binaries/particl/
cp ~/tmp/particl-23.1.5.0-x86_64-linux-gnu.tar.gz /tmp/pdtests/node2/.config/particl-desktop-testing/binaries/particl/
sudo chmod 777 -R /tmp/pdtests/{node1,node2}

xhost +
docker compose up


python ./test/test_client.py



# Run tests without Docker image

https://github.com/nvm-sh/nvm#installing-and-updating

cd $HOME/tmp/work/particl/particl-desktop

xhost +
sudo useradd -m pdtest

sudo su pdtest
python -m venv $HOME/venv
source $HOME/venv/bin/activate
pip3 install selenium


rm -r /home/pdtest/.config/particl-desktop-testing
rm -r /home/pdtest/.particl
mkdir -p /home/pdtest/.config/particl-desktop-testing/settings/
mkdir -p /home/pdtest/.particl
cp test/particl-core.json /home/pdtest/.config/particl-desktop-testing/settings/particl-core.json
cp test/particl.conf /home/pdtest/.particl/


wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
export NODE_VERSION=v16
export NVM_DIR="$HOME/.nvm"; [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
nvm install $NODE_VERSION && nvm use $NODE_VERSION

cd ~/particl-desktop
yarn add --dev electron-chromedriver@19.0.0
yarn add --dev selenium-webdriver
yarn install
yarn package:linux_zip

./node_modules/.bin/chromedriver & python3 -u ./test/test_splitter.py


rm -r /home/pdtest/.config/particl-desktop-testing/
rm -r /home/pdtest/.particl

sudo userdel pdtest
sudo rm -r /home/pdtest

